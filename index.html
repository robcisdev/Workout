<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Timer Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF8C00',
                        'primary-dark': '#FF6B00',
                        'industrial-orange': '#FF8C00',
                        'industrial-yellow': '#FFB300',
                        'industrial-dark': '#1A1A1A',
                        'industrial-steel': '#2D2D2D',
                        'industrial-light': '#3A3A3A',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .timer-display {
            font-family: 'Inter', monospace;
            font-weight: 700;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.1s linear;
        }
        
        .pulse-animation {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .workout-item {
            transition: all 0.3s ease;
        }
        
        .workout-item:hover {
            transform: translateY(-2px);
        }
        
        .timeline-item {
            transition: all 0.2s ease;
        }
        
        .timeline-active {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(255, 140, 0, 0.4);
        }
        
        .dashboard-mode {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: linear-gradient(135deg, #1A1A1A 0%, #2D2D2D 50%, #3A3A3A 100%);
            display: none;
        }
        
        .dashboard-mode.active {
            display: flex;
        }
        
        .big-timer {
            font-size: 8rem;
            line-height: 1;
        }
        
        .big-progress {
            width: 400px;
            height: 400px;
        }
        
        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .glow-animation {
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 140, 0, 0.5); }
            to { box-shadow: 0 0 40px rgba(255, 140, 0, 0.8); }
        }
        
        /* Enhanced responsive design for dashboard */
        @media (max-height: 800px) {
            .dashboard-mode .floating-animation h1 {
                font-size: 3.5rem !important;
            }
            .big-timer {
                font-size: 4rem;
            }
            .big-progress {
                width: 280px;
                height: 280px;
            }
            .dashboard-mode .mb-8 {
                margin-bottom: 1.5rem !important;
            }
            .dashboard-mode .mb-6 {
                margin-bottom: 1rem !important;
            }
        }

        @media (max-height: 700px) {
            .dashboard-mode .floating-animation h1 {
                font-size: 2.5rem !important;
            }
            .dashboard-mode .floating-animation .text-2xl {
                font-size: 1.25rem !important;
            }
            .dashboard-mode .floating-animation .text-3xl {
                font-size: 1.5rem !important;
            }
            .big-timer {
                font-size: 3rem;
            }
            .big-progress {
                width: 220px;
                height: 220px;
            }
            .dashboard-mode .mb-8 {
                margin-bottom: 1rem !important;
            }
            .dashboard-mode .mb-6 {
                margin-bottom: 0.75rem !important;
            }
        }

        @media (max-width: 768px) {
            .big-timer {
                font-size: 3rem;
                line-height: 1;
            }
            .big-progress {
                width: 250px;
                height: 250px;
            }
            .dashboard-mode .floating-animation h1 {
                font-size: 3rem !important;
            }
            .dashboard-mode .floating-animation .text-2xl {
                font-size: 1.25rem !important;
            }
            .dashboard-mode .floating-animation .text-3xl {
                font-size: 1.5rem !important;
            }
        }

        @media (max-width: 480px) {
            .big-timer {
                font-size: 2.5rem;
            }
            .big-progress {
                width: 200px;
                height: 200px;
            }
            .dashboard-mode .floating-animation h1 {
                font-size: 2.5rem !important;
            }
            .dashboard-mode .floating-animation .text-2xl {
                font-size: 1rem !important;
            }
            .dashboard-mode .floating-animation .text-3xl {
                font-size: 1.25rem !important;
            }
            .dashboard-mode .flex-wrap {
                flex-direction: column;
                gap: 1rem;
            }
            .dashboard-mode .flex-wrap button {
                width: 100%;
                max-width: 300px;
            }
        }

        /* Landscape phone specific */
        @media (max-height: 500px) and (orientation: landscape) {
            .dashboard-mode .floating-animation h1 {
                font-size: 2rem !important;
            }
            .dashboard-mode .floating-animation .text-2xl {
                font-size: 1rem !important;
            }
            .dashboard-mode .floating-animation .text-3xl {
                font-size: 1.125rem !important;
            }
            .big-timer {
                font-size: 2rem;
            }
            .big-progress {
                width: 160px;
                height: 160px;
            }
            .dashboard-mode .mb-8 {
                margin-bottom: 0.5rem !important;
            }
            .dashboard-mode .mb-6 {
                margin-bottom: 0.5rem !important;
            }
            .dashboard-mode .grid {
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 0.5rem !important;
            }
            .dashboard-mode .grid > div {
                padding: 0.5rem !important;
            }
        }

        /* Rep Progress Squares */
        .rep-square {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            margin: 2px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 140, 0, 0.3);
        }

        .rep-square.completed {
            background: linear-gradient(135deg, #FF8C00, #FFB300);
            box-shadow: 0 0 8px rgba(255, 140, 0, 0.5);
        }

        .rep-square.current {
            background: linear-gradient(135deg, #FFB300, #FFD700);
            animation: pulse-rep 1s infinite;
            box-shadow: 0 0 12px rgba(255, 179, 0, 0.7);
        }

        .rep-square.remaining {
            background: rgba(255, 140, 0, 0.15);
            border: 1px solid rgba(255, 140, 0, 0.3);
        }

        @keyframes pulse-rep {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        .exercise-progress {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 1px;
            padding: 8px;
            background: rgba(255, 140, 0, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 140, 0, 0.2);
        }

        /* Enhanced Progress Bar with Squares */
        .progress-bar-container {
            position: relative;
            width: 100%;
            height: 24px;
            background: #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
        }

        .dark .progress-bar-container {
            background: #374151;
        }

        .progress-bar-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #FF8C00, #FFB300);
            border-radius: 12px;
            transition: width 0.3s ease;
        }

        .progress-squares {
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 4px;
            width: calc(100% - 4px);
        }

        .progress-round-square {
            width: 8px;
            height: 8px;
            border-radius: 2px;
            transition: all 0.3s ease;
            flex: 0 0 8px;
        }

        .progress-round-square.completed {
            background: #FFFFFF;
            box-shadow: 0 0 4px rgba(255, 255, 255, 0.5);
        }

        .progress-round-square.current {
            background: #FFD700;
            animation: pulse-progress 1s infinite;
            box-shadow: 0 0 6px rgba(255, 215, 0, 0.8);
        }

        .progress-round-square.remaining {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        @keyframes pulse-progress {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Dashboard Progress Squares */
        .dash-progress-squares {
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 4px;
            width: calc(100% - 4px);
        }
        
        /* Drag and Drop Styles */
        .drag-mode-active .timeline-item {
            cursor: grab;
            transition: all 0.2s ease;
        }
        
        .drag-mode-active .timeline-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .timeline-item.dragging {
            opacity: 0.6;
            transform: rotate(2deg) scale(1.05);
            cursor: grabbing;
            z-index: 1000;
            pointer-events: none;
        }
        
        .timeline-item.drag-over {
            border-top: 3px solid #5D5CDE;
            margin-top: 8px;
        }
        
        .drag-placeholder {
            height: 80px;
            border: 2px dashed #FF8C00;
            border-radius: 8px;
            background: rgba(255, 140, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FF8C00;
            font-weight: 500;
            margin: 8px 0;
        }
        
        .drag-ghost {
            position: fixed;
            pointer-events: none;
            z-index: 1001;
            transform: rotate(2deg) scale(1.05);
            opacity: 0.8;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="fixed inset-0 bg-gradient-to-br from-industrial-dark via-industrial-steel to-black flex items-center justify-center z-50">
        <div class="bg-industrial-steel border-2 border-industrial-orange rounded-2xl p-8 shadow-2xl max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">‚ö°</div>
                <h1 class="text-3xl font-bold text-white mb-2">WORKOUT TIMER PRO</h1>
                <p class="text-orange-300 font-medium">ENTER CODE TO ACCESS TRAINING</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="passwordInput" class="block text-sm font-bold mb-2 text-orange-300">ACCESS CODE</label>
                    <input type="password" id="passwordInput" 
                           class="w-full px-4 py-3 text-base border-2 border-industrial-orange rounded-lg bg-industrial-dark text-white focus:ring-2 focus:ring-industrial-yellow focus:border-industrial-yellow font-mono"
                           placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-industrial-orange to-industrial-yellow text-black py-3 rounded-lg font-bold transition-all transform hover:scale-105 hover:shadow-lg">
                    ‚ö° UNLOCK SYSTEM
                </button>
                
                <div id="loginError" class="hidden text-red-400 text-sm text-center bg-red-900/30 border border-red-600 p-3 rounded-lg">
                    ‚ö†Ô∏è ACCESS DENIED. TRY AGAIN.
                </div>
            </form>
            
            <div class="mt-6 text-center">
                <div class="text-xs text-orange-500 font-medium">
                    üîí SECURED TRAINING ACCESS SYSTEM
                </div>
            </div>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <!-- Logout Button -->
        <div class="fixed top-4 right-4 z-40">
            <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-all transform hover:scale-105">
                üîí Logout
            </button>
        </div>
        
        <div class="container mx-auto px-4 py-6 max-w-6xl">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-center mb-2">Workout Timer Pro</h1>
            <p class="text-gray-600 dark:text-gray-400 text-center">Design and execute your perfect workout</p>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Timer Section -->
            <div class="space-y-6">
                <!-- Main Timer Display -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-3xl p-8 text-center relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-primary/10 to-transparent"></div>
                    <div class="relative z-10">
                        <!-- Current Exercise Info -->
                        <div class="mb-6">
                            <h2 class="text-xl font-semibold mb-2" id="currentExercise">Ready to Start</h2>
                            <div class="flex justify-center items-center space-x-4 text-sm text-gray-600 dark:text-gray-400">
                                <span id="currentRep">Rep 0 of 0</span>
                                <span id="currentPhase">Ready</span>
                            </div>
                        </div>

                        <!-- Circular Progress Timer -->
                        <div class="relative mx-auto mb-6" style="width: 200px; height: 200px;">
                            <svg class="progress-ring w-full h-full">
                                <circle cx="100" cy="100" r="90" fill="transparent" stroke="currentColor" 
                                        stroke-width="4" class="text-gray-300 dark:text-gray-600"></circle>
                                <circle cx="100" cy="100" r="90" fill="transparent" stroke="currentColor" 
                                        stroke-width="6" class="text-primary progress-ring-circle" 
                                        stroke-dasharray="565.48" stroke-dashoffset="565.48" id="progressCircle"></circle>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="timer-display text-4xl font-bold" id="timerDisplay">00:00</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400 mt-1" id="timerLabel">Ready</div>
                                </div>
                            </div>
                        </div>

                        <!-- Rep Progress Visualization -->
                        <div class="mb-6" id="repProgressContainer" style="display: none;">
                            <h3 class="text-sm font-medium text-center mb-3 text-gray-600 dark:text-gray-400">Rep Progress</h3>
                            <div class="exercise-progress" id="repProgressSquares"></div>
                        </div>

                        <!-- Control Buttons -->
                        <div class="flex justify-center space-x-4">
                            <button id="startBtn" class="bg-primary hover:bg-primary-dark text-white px-8 py-3 rounded-full font-semibold transition-all transform hover:scale-105">
                                Start Workout
                            </button>
                            <button id="pauseBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-full font-semibold transition-all transform hover:scale-105 hidden">
                                Pause
                            </button>
                            <button id="skipBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full font-semibold transition-all transform hover:scale-105 hidden">
                                Skip Rest
                            </button>
                            <button id="resetBtn" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-full font-semibold transition-all transform hover:scale-105">
                                Reset Phase
                            </button>
                            <button id="fullscreenBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full font-semibold transition-all transform hover:scale-105">
                                Dashboard
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Overall Progress -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-2xl p-6">
                    <h3 class="text-lg font-semibold mb-4">Workout Progress</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm">
                            <span>Overall Progress</span>
                            <span id="overallProgress">0%</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" id="overallProgressBar" style="width: 0%"></div>
                            <div class="progress-squares" id="overallProgressSquares"></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-600 dark:text-gray-400">
                            <span id="timeElapsed">00:00</span>
                            <span id="timeRemaining">00:00</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Workout Editor & Timeline -->
            <div class="space-y-6">
                <!-- Workout Editor -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-2xl p-6">
                    <h3 class="text-lg font-semibold mb-4">Workout Editor</h3>
                    
                    <!-- Add Exercise Form -->
                    <div class="space-y-4 mb-6">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <input type="text" id="exerciseTitle" placeholder="Exercise name" 
                                   class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                            <input type="number" id="exerciseReps" placeholder="Reps" min="1" value="3"
                                   class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Work Time (seconds)</label>
                                <input type="number" id="workTime" value="45" min="1"
                                       class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Rest Time (seconds)</label>
                                <input type="number" id="restTime" value="105" min="0"
                                       class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                        </div>
                        <button id="addExerciseBtn" class="w-full bg-primary hover:bg-primary-dark text-white py-3 rounded-lg font-semibold transition-all">
                            Add Exercise
                        </button>
                    </div>
                    
                    <!-- Save/Load Section -->
                    <div class="border-t pt-4 space-y-3">
                        <div class="flex space-x-3">
                            <button id="saveWorkoutBtn" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg font-semibold transition-all">
                                üíæ Save Workout
                            </button>
                            <button id="loadWorkoutBtn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-semibold transition-all">
                                üìÅ Load Workout
                            </button>
                        </div>
                        <input type="file" id="fileInput" accept=".json" style="display: none;">
                    </div>
                </div>

                <!-- Quick Workout Templates -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-2xl p-6">
                    <h3 class="text-lg font-semibold mb-4">Quick Start Templates</h3>
                    <div class="space-y-2">
                        <button class="template-btn w-full text-left p-3 bg-white dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-all" data-template="hiit">
                            <div class="font-medium">HIIT Workout</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">4 exercises, 30s work, 15s rest</div>
                        </button>
                        <button class="template-btn w-full text-left p-3 bg-white dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-all" data-template="tabata">
                            <div class="font-medium">Tabata</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">8 rounds, 20s work, 10s rest</div>
                        </button>
                        <button class="template-btn w-full text-left p-3 bg-white dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-all" data-template="strength">
                            <div class="font-medium">Strength Training</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">5 exercises, 60s work, 90s rest</div>
                        </button>
                    </div>
                </div>

                <!-- Workout Timeline -->
                <div class="bg-gray-50 dark:bg-gray-800 rounded-2xl p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Workout Timeline</h3>
                        <button id="dragModeBtn" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-all transform hover:scale-105">
                            üéØ Drag Mode
                        </button>
                    </div>
                    <div id="dragModeIndicator" class="hidden bg-purple-100 dark:bg-purple-900 border border-purple-300 dark:border-purple-700 rounded-lg p-3 mb-4">
                        <div class="text-purple-700 dark:text-purple-300 text-sm">
                            üì± <strong>Drag Mode Active:</strong> Touch and drag exercises to reorder them
                        </div>
                    </div>
                    <div id="workoutTimeline" class="space-y-3 max-h-96 overflow-y-auto">
                        <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                            No exercises added yet. Add your first exercise above!
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fullscreen Dashboard Mode -->
    <div id="dashboardMode" class="dashboard-mode text-white">
        <div class="flex flex-col w-full h-full">
            <!-- Close Button -->
            <button id="closeDashboard" class="absolute top-6 right-6 text-white text-3xl hover:text-gray-300 transition-colors z-10">
                ‚úï
            </button>
            
            <!-- Top Section: Overall Progress -->
            <div class="flex-shrink-0 w-full px-8 pt-6 pb-4">
                <div class="max-w-6xl mx-auto">
                    <div class="flex justify-between items-center text-2xl text-white/80 mb-3">
                        <span class="font-semibold">Overall Progress</span>
                        <span id="dashOverallProgressTop" class="text-5xl md:text-6xl font-bold text-orange-300">0%</span>
                    </div>
                    <div class="progress-bar-container" style="background: rgba(255,255,255,0.2); height: 32px;">
                        <div class="bg-white h-full rounded-full transition-all duration-300" style="width: 0%" id="dashOverallProgressBarTop"></div>
                        <div class="dash-progress-squares" id="dashOverallProgressSquaresTop"></div>
                    </div>
                    <div class="flex justify-between text-lg text-white/60 mt-3">
                        <span id="dashTimeElapsedTop">00:00</span>
                        <span id="dashTimeRemainingTop">00:00</span>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="flex-1 flex flex-col lg:flex-row items-center justify-center px-8 py-4 gap-8">
                <!-- Left Column: Exercise Info & Timer -->
                <div class="flex flex-col items-center justify-center lg:w-1/2">
                    <!-- Current Exercise Section -->
                    <div class="text-center mb-6 floating-animation">
                        <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold mb-3" id="dashCurrentExercise">Ready to Start</h1>
                        <div class="text-xl md:text-2xl lg:text-3xl text-white/80 mb-2" id="dashCurrentRep">Rep 0 of 0</div>
                        <div class="text-2xl md:text-3xl lg:text-4xl font-semibold glow-animation" id="dashCurrentPhase">Ready</div>
                    </div>

                    <!-- Big Timer Circle -->
                    <div class="relative mb-6 floating-animation">
                        <div class="big-progress relative">
                            <svg class="progress-ring w-full h-full" viewBox="0 0 400 400">
                                <circle cx="200" cy="200" r="180" fill="transparent" stroke="rgba(255,255,255,0.2)" 
                                        stroke-width="8"></circle>
                                <circle cx="200" cy="200" r="180" fill="transparent" stroke="white" 
                                        stroke-width="12" class="progress-ring-circle" 
                                        stroke-dasharray="1130.97" stroke-dashoffset="1130.97" id="dashProgressCircle"></circle>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="timer-display big-timer font-bold" id="dashTimerDisplay">00:00</div>
                                    <div class="text-xl md:text-2xl lg:text-3xl text-white/70 mt-4" id="dashTimerLabel">Ready</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard Rep Progress -->
                    <div class="text-center mb-6" id="dashRepProgressContainer" style="display: none;">
                        <div class="text-xl text-white/60 mb-4">Rep Progress</div>
                        <div class="flex justify-center">
                            <div class="exercise-progress bg-white/10 border-white/20" id="dashRepProgressSquares"></div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: KPIs & Next Exercise -->
                <div class="flex flex-col items-center justify-center lg:w-1/2">
                    <!-- Real-time KPIs -->
                    <div class="grid grid-cols-2 gap-6 mb-8 w-full max-w-lg" id="dashKPIs" style="display: none;">
                        <div class="bg-white/10 rounded-xl p-6 text-center border border-white/20 backdrop-blur-sm">
                            <div class="text-4xl md:text-5xl font-bold text-orange-300 mb-2" id="totalRepsCompleted">0</div>
                            <div class="text-lg text-white/70">Reps Done</div>
                        </div>
                        <div class="bg-white/10 rounded-xl p-6 text-center border border-white/20 backdrop-blur-sm">
                            <div class="text-4xl md:text-5xl font-bold text-orange-300 mb-2" id="avgRepTime">0:00</div>
                            <div class="text-lg text-white/70">Avg Rep</div>
                        </div>
                        <div class="bg-white/10 rounded-xl p-6 text-center border border-white/20 backdrop-blur-sm">
                            <div class="text-4xl md:text-5xl font-bold text-orange-300 mb-2" id="workoutIntensity">0%</div>
                            <div class="text-lg text-white/70">Intensity</div>
                        </div>
                        <div class="bg-white/10 rounded-xl p-6 text-center border border-white/20 backdrop-blur-sm">
                            <div class="text-4xl md:text-5xl font-bold text-orange-300 mb-2" id="caloriesBurned">0</div>
                            <div class="text-lg text-white/70">Calories</div>
                        </div>
                    </div>

                    <!-- Next Exercise Preview -->
                    <div class="text-center mb-8 bg-white/10 rounded-xl p-6 backdrop-blur-sm border border-white/20 w-full max-w-lg" id="nextExerciseSection" style="display: none;">
                        <div class="text-xl text-white/60 mb-3">Up Next:</div>
                        <div class="text-2xl md:text-3xl lg:text-4xl font-semibold text-white/90 mb-2" id="nextExerciseName">-</div>
                        <div class="text-lg md:text-xl text-white/70" id="nextExerciseDetails">-</div>
                    </div>
                </div>
            </div>

            <!-- Bottom Section: Controls -->
            <div class="flex-shrink-0 w-full px-8 pb-6">
                <div class="flex flex-wrap justify-center gap-4 max-w-4xl mx-auto">
                    <button id="dashStartBtn" class="bg-white text-purple-600 px-10 py-5 rounded-full text-xl md:text-2xl font-semibold hover:bg-gray-100 transition-all transform hover:scale-105 shadow-lg">
                        Start Workout
                    </button>
                    <button id="dashPauseBtn" class="bg-gray-600 text-white px-10 py-5 rounded-full text-xl md:text-2xl font-semibold hover:bg-gray-700 transition-all transform hover:scale-105 shadow-lg hidden">
                        Pause
                    </button>
                    <button id="dashSkipBtn" class="bg-green-600 text-white px-8 py-5 rounded-full text-xl md:text-2xl font-semibold hover:bg-green-700 transition-all transform hover:scale-105 shadow-lg hidden">
                        Skip Rest
                    </button>
                    <button id="dashResetBtn" class="bg-orange-600 text-white px-8 py-5 rounded-full text-xl md:text-2xl font-semibold hover:bg-orange-700 transition-all transform hover:scale-105 shadow-lg">
                        Reset Phase
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables to avoid scope issues
        var timer = null;
        var exercises = [];
        var currentExerciseIndex = 0;
        var currentRep = 0;
        var isWorkPhase = true;
        var timeRemaining = 0;
        var isRunning = false;
        var isPaused = false;
        var totalWorkoutTime = 0;
        var elapsedTime = 0;
        var timerInterval = null;
        var audioContext = null;

        // Dark mode detection
        try {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            if (window.matchMedia) {
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(event) {
                    if (event.matches) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                });
            }
        } catch (e) {
            console.log('Dark mode detection failed');
        }

        // Initialize audio
        function initializeAudio() {
            try {
                var AudioCtx = window.AudioContext || window.webkitAudioContext;
                if (AudioCtx) {
                    audioContext = new AudioCtx();
                }
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        function playBeep(frequency, duration) {
            if (!audioContext) return;
            
            try {
                var oscillator = audioContext.createOscillator();
                var gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency || 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + (duration || 200) / 1000);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + (duration || 200) / 1000);
            } catch (e) {
                console.log('Beep failed');
            }
        }

        function addExercise() {
            var title = document.getElementById('exerciseTitle').value.trim();
            var reps = parseInt(document.getElementById('exerciseReps').value) || 1;
            var workTime = parseInt(document.getElementById('workTime').value) || 45;
            var restTime = parseInt(document.getElementById('restTime').value) || 105;

            if (!title) {
                showAlert('Please enter an exercise name');
                return;
            }

            var exercise = { title: title, reps: reps, workTime: workTime, restTime: restTime };
            exercises.push(exercise);
            
            // Clear form
            document.getElementById('exerciseTitle').value = '';
            document.getElementById('exerciseReps').value = '3';
            document.getElementById('workTime').value = '45';
            document.getElementById('restTime').value = '105';
            
            updateTimeline();
            calculateTotalTime();
        }

        function updateTimeline() {
            var timeline = document.getElementById('workoutTimeline');
            
            if (exercises.length === 0) {
                timeline.innerHTML = '<div class="text-center text-gray-500 dark:text-gray-400 py-8">No exercises added yet. Add your first exercise above!</div>';
                return;
            }

            var html = '';
            for (var i = 0; i < exercises.length; i++) {
                var exercise = exercises[i];
                var isActive = isRunning && i === currentExerciseIndex;
                var isCompleted = isRunning && i < currentExerciseIndex;
                
                var borderClass = 'border-gray-300 dark:border-gray-600';
                if (isActive) borderClass = 'border-primary timeline-active';
                if (isCompleted) borderClass = 'border-green-500';
                
                var titleClass = isActive ? 'text-primary' : '';
                var statusHtml = isActive ? '<div class="text-xs text-primary mt-1 font-medium">Rep ' + (currentRep + 1) + ' of ' + exercise.reps + ' - ' + (isWorkPhase ? 'WORK' : 'REST') + '</div>' : '';
                
                html += '<div class="timeline-item bg-white dark:bg-gray-700 p-4 rounded-lg border-l-4 ' + borderClass + '" data-exercise-index="' + i + '">';
                html += '<div class="flex justify-between items-start">';
                html += '<div class="flex-1">';
                html += '<h4 class="font-semibold ' + titleClass + '">' + exercise.title + '</h4>';
                html += '<div class="text-sm text-gray-600 dark:text-gray-400 mt-1">' + exercise.reps + ' reps √ó ' + exercise.workTime + 's work / ' + exercise.restTime + 's rest</div>';
                html += statusHtml;
                html += '</div>';
                html += '<div class="flex flex-col space-y-1 ml-4">';
                html += '<div class="flex space-x-2">';
                html += '<button class="edit-exercise-btn text-blue-500 hover:text-blue-700 text-sm" data-index="' + i + '">Edit</button>';
                html += '<button class="delete-exercise-btn text-red-500 hover:text-red-700 text-sm" data-index="' + i + '">Delete</button>';
                html += '</div>';
                html += '<div class="flex space-x-1">';
                if (i > 0) {
                    html += '<button class="move-up-btn text-gray-500 hover:text-gray-700 text-xs bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded" data-index="' + i + '">‚Üë</button>';
                }
                if (i < exercises.length - 1) {
                    html += '<button class="move-down-btn text-gray-500 hover:text-gray-700 text-xs bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded" data-index="' + i + '">‚Üì</button>';
                }
                html += '</div>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
            }
            
            timeline.innerHTML = html;
        }

        function calculateTotalTime() {
            totalWorkoutTime = 0;
            for (var i = 0; i < exercises.length; i++) {
                var exercise = exercises[i];
                totalWorkoutTime += exercise.reps * (exercise.workTime + exercise.restTime);
            }
            updateTimeDisplay();
        }

        function startWorkout() {
            if (exercises.length === 0) {
                showAlert('Please add at least one exercise to start the workout');
                return;
            }

            // Enable audio context if needed
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }

            if (isPaused) {
                isPaused = false;
            } else {
                currentExerciseIndex = 0;
                currentRep = 0;
                isWorkPhase = true;
                elapsedTime = 0;
                timeRemaining = exercises[0].workTime;
            }

            isRunning = true;
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'inline-block';
            
            updateDisplay();
            updateTimeline();
            startTimer();
        }

        function pauseWorkout() {
            isPaused = true;
            isRunning = false;
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'none';
            
            if (timerInterval) {
                clearInterval(timerInterval);
            }
        }

        function resetCurrentPhase() {
            if (!isRunning && !isPaused) {
                // Full reset if not in a workout
                resetWorkout();
                return;
            }
            
            // Reset current phase only
            var currentExercise = exercises[currentExerciseIndex];
            if (currentExercise) {
                timeRemaining = isWorkPhase ? currentExercise.workTime : currentExercise.restTime;
                updateDisplay();
                updateDashboard();
            }
        }

        function resetWorkout() {
            isRunning = false;
            isPaused = false;
            currentExerciseIndex = 0;
            currentRep = 0;
            isWorkPhase = true;
            timeRemaining = 0;
            elapsedTime = 0;
            
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('startBtn').textContent = 'Start Workout';
            
            // Update dashboard buttons
            document.getElementById('dashStartBtn').style.display = 'inline-block';
            document.getElementById('dashPauseBtn').style.display = 'none';
            document.getElementById('dashStartBtn').textContent = 'Start Workout';
            
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            updateDisplay();
            updateDashboard();
            updateTimeline();
        }

        function startTimer() {
            timerInterval = setInterval(function() {
                timeRemaining--;
                elapsedTime++;
                
                // Audio countdown for last 5 seconds
                if (timeRemaining <= 5 && timeRemaining > 0) {
                    playBeep(600, 150);
                }
                
                updateDisplay();
                updateDashboard();
                
                if (timeRemaining <= 0) {
                    playBeep(1000, 300); // End beep
                    nextPhase();
                }
            }, 1000);
        }

        function nextPhase() {
            var currentExercise = exercises[currentExerciseIndex];
            
            if (isWorkPhase) {
                // Switch to rest phase
                isWorkPhase = false;
                timeRemaining = currentExercise.restTime;
            } else {
                // Switch to next rep or exercise
                currentRep++;
                
                if (currentRep >= currentExercise.reps) {
                    // Move to next exercise
                    currentExerciseIndex++;
                    currentRep = 0;
                    
                    if (currentExerciseIndex >= exercises.length) {
                        // Workout complete
                        completeWorkout();
                        return;
                    }
                    
                    var nextExercise = exercises[currentExerciseIndex];
                    timeRemaining = nextExercise.workTime;
                } else {
                    // Next rep of same exercise
                    timeRemaining = currentExercise.workTime;
                }
                
                isWorkPhase = true;
            }
            
            updateDisplay();
            updateTimeline();
        }

        function completeWorkout() {
            isRunning = false;
            clearInterval(timerInterval);
            
            document.getElementById('currentExercise').textContent = 'Workout Complete!';
            document.getElementById('currentRep').textContent = 'Great job!';
            document.getElementById('currentPhase').textContent = 'Finished';
            document.getElementById('timerDisplay').textContent = '00:00';
            document.getElementById('timerLabel').textContent = 'Complete';
            
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('startBtn').textContent = 'Start New Workout';
            
            // Celebration beeps
            setTimeout(function() { playBeep(800, 200); }, 0);
            setTimeout(function() { playBeep(1000, 200); }, 200);
            setTimeout(function() { playBeep(1200, 300); }, 400);
            
            updateTimeline();
        }

        function updateDisplay() {
            if (exercises.length === 0) {
                document.getElementById('currentExercise').textContent = 'Ready to Start';
                document.getElementById('currentRep').textContent = 'Rep 0 of 0';
                document.getElementById('currentPhase').textContent = 'Ready';
                document.getElementById('timerDisplay').textContent = '00:00';
                document.getElementById('timerLabel').textContent = 'Ready';
                document.getElementById('repProgressContainer').style.display = 'none';
                return;
            }

            var currentExercise = exercises[currentExerciseIndex];
            
            if (isRunning || isPaused) {
                document.getElementById('currentExercise').textContent = currentExercise.title;
                document.getElementById('currentRep').textContent = 'Rep ' + (currentRep + 1) + ' of ' + currentExercise.reps;
                document.getElementById('currentPhase').textContent = isWorkPhase ? 'WORK' : 'REST';
                document.getElementById('timerLabel').textContent = isWorkPhase ? 'Work Time' : 'Rest Time';
                
                // Show and update rep progress
                document.getElementById('repProgressContainer').style.display = 'block';
                updateRepProgress();
                
                // Update circular progress (countdown style - starts full, empties as time runs out)
                var totalTime = isWorkPhase ? currentExercise.workTime : currentExercise.restTime;
                var progress = (timeRemaining / totalTime) * 100; // Countdown: full to empty
                var circumference = 2 * Math.PI * 90;
                var offset = circumference - (progress / 100 * circumference);
                document.getElementById('progressCircle').style.strokeDashoffset = offset;
                
                // Add pulse animation for last 5 seconds
                var timerDisplay = document.getElementById('timerDisplay');
                if (timeRemaining <= 5) {
                    timerDisplay.classList.add('pulse-animation');
                } else {
                    timerDisplay.classList.remove('pulse-animation');
                }
            } else {
                document.getElementById('repProgressContainer').style.display = 'none';
            }
            
            document.getElementById('timerDisplay').textContent = formatTime(timeRemaining);
            updateTimeDisplay();
            updateSkipButton();
        }

        function updateRepProgress() {
            if (exercises.length === 0 || !isRunning) return;
            
            var currentExercise = exercises[currentExerciseIndex];
            var container = document.getElementById('repProgressSquares');
            
            var html = '';
            for (var i = 0; i < currentExercise.reps; i++) {
                var squareClass = 'rep-square ';
                
                if (i < currentRep) {
                    // Completed reps
                    squareClass += 'completed';
                } else if (i === currentRep) {
                    // Current rep
                    squareClass += 'current';
                } else {
                    // Remaining reps
                    squareClass += 'remaining';
                }
                
                html += '<div class="' + squareClass + '" title="Rep ' + (i + 1) + '"></div>';
            }
            
            container.innerHTML = html;
        }

        function updateTimeDisplay() {
            var overallProgress = totalWorkoutTime > 0 ? (elapsedTime / totalWorkoutTime) * 100 : 0;
            document.getElementById('overallProgress').textContent = Math.round(overallProgress) + '%';
            document.getElementById('overallProgressBar').style.width = overallProgress + '%';
            
            // Update progress squares
            updateOverallProgressSquares();
            
            document.getElementById('timeElapsed').textContent = formatTime(elapsedTime);
            document.getElementById('timeRemaining').textContent = formatTime(Math.max(0, totalWorkoutTime - elapsedTime));
        }

        function updateOverallProgressSquares() {
            if (exercises.length === 0) return;
            
            // Calculate total rounds
            var totalRounds = 0;
            for (var i = 0; i < exercises.length; i++) {
                totalRounds += exercises[i].reps;
            }
            
            // Calculate current round position
            var currentRoundIndex = 0;
            for (var i = 0; i < currentExerciseIndex; i++) {
                currentRoundIndex += exercises[i].reps;
            }
            currentRoundIndex += currentRep;
            
            // Generate squares for both main and dashboard
            var squareHtml = '';
            for (var i = 0; i < totalRounds; i++) {
                var squareClass = 'progress-round-square ';
                
                if (i < currentRoundIndex) {
                    // Completed rounds
                    squareClass += 'completed';
                } else if (i === currentRoundIndex && isRunning) {
                    // Current round
                    squareClass += 'current';
                } else {
                    // Remaining rounds
                    squareClass += 'remaining';
                }
                
                var exerciseInfo = getRoundExerciseInfo(i);
                var tooltipText = exerciseInfo.title + ' - Rep ' + (exerciseInfo.repNumber + 1);
                
                squareHtml += '<div class="' + squareClass + '" title="' + tooltipText + '"></div>';
            }
            
            // Update all progress containers
            var mainContainer = document.getElementById('overallProgressSquares');
            var dashContainer = document.getElementById('dashOverallProgressSquares');
            var dashTopContainer = document.getElementById('dashOverallProgressSquaresTop');
            
            if (mainContainer) mainContainer.innerHTML = squareHtml;
            if (dashContainer) dashContainer.innerHTML = squareHtml;
            if (dashTopContainer) dashTopContainer.innerHTML = squareHtml;
        }

        function getRoundExerciseInfo(roundIndex) {
            var currentRound = 0;
            
            for (var i = 0; i < exercises.length; i++) {
                var exercise = exercises[i];
                if (roundIndex < currentRound + exercise.reps) {
                    return {
                        title: exercise.title,
                        repNumber: roundIndex - currentRound
                    };
                }
                currentRound += exercise.reps;
            }
            
            return { title: 'Unknown', repNumber: 0 };
        }

        function formatTime(seconds) {
            var mins = Math.floor(seconds / 60);
            var secs = seconds % 60;
            var minsStr = mins < 10 ? '0' + mins : mins;
            var secsStr = secs < 10 ? '0' + secs : secs;
            return minsStr + ':' + secsStr;
        }

        function showAlert(message) {
            var modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = '<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4"><p class="text-gray-700 dark:text-gray-300 mb-4">' + message + '</p><div class="flex justify-end"><button class="ok-btn px-4 py-2 bg-primary text-white hover:bg-primary-dark rounded">OK</button></div></div>';
            document.body.appendChild(modal);
            
            modal.querySelector('.ok-btn').addEventListener('click', function() {
                modal.remove();
            });
        }

        function showConfirmDialog(message, onConfirm) {
            var modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = '<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4"><p class="text-gray-700 dark:text-gray-300 mb-4">' + message + '</p><div class="flex justify-end space-x-3"><button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Cancel</button><button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">Confirm</button></div></div>';
            document.body.appendChild(modal);
            
            modal.querySelector('.cancel-btn').addEventListener('click', function() {
                modal.remove();
            });
            
            modal.querySelector('.confirm-btn').addEventListener('click', function() {
                modal.remove();
                onConfirm();
            });
        }

        function deleteExercise(index) {
            showConfirmDialog('Are you sure you want to delete this exercise?', function() {
                exercises.splice(index, 1);
                updateTimeline();
                calculateTotalTime();
                
                // Adjust current exercise index if needed
                if (currentExerciseIndex >= exercises.length) {
                    currentExerciseIndex = Math.max(0, exercises.length - 1);
                }
            });
        }

        function editExercise(index) {
            var exercise = exercises[index];
            if (!exercise) return;

            // Create inline edit form
            var timelineItem = document.querySelector('[data-exercise-index="' + index + '"]');
            var originalContent = timelineItem.innerHTML;
            
            timelineItem.innerHTML = '<div class="space-y-2">' +
                '<input type="text" value="' + exercise.title + '" class="w-full px-3 py-2 text-sm border rounded edit-title">' +
                '<div class="grid grid-cols-3 gap-2">' +
                    '<input type="number" value="' + exercise.reps + '" min="1" class="px-2 py-1 text-sm border rounded edit-reps" placeholder="Reps">' +
                    '<input type="number" value="' + exercise.workTime + '" min="1" class="px-2 py-1 text-sm border rounded edit-work" placeholder="Work">' +
                    '<input type="number" value="' + exercise.restTime + '" min="0" class="px-2 py-1 text-sm border rounded edit-rest" placeholder="Rest">' +
                '</div>' +
                '<div class="flex space-x-2">' +
                    '<button class="save-edit-btn bg-green-500 text-white px-3 py-1 rounded text-sm">Save</button>' +
                    '<button class="cancel-edit-btn bg-gray-500 text-white px-3 py-1 rounded text-sm">Cancel</button>' +
                '</div>' +
            '</div>';

            var saveBtn = timelineItem.querySelector('.save-edit-btn');
            var cancelBtn = timelineItem.querySelector('.cancel-edit-btn');

            saveBtn.addEventListener('click', function() {
                var newTitle = timelineItem.querySelector('.edit-title').value.trim();
                var newReps = parseInt(timelineItem.querySelector('.edit-reps').value);
                var newWork = parseInt(timelineItem.querySelector('.edit-work').value);
                var newRest = parseInt(timelineItem.querySelector('.edit-rest').value);

                if (newTitle && newReps > 0 && newWork > 0 && newRest >= 0) {
                    exercises[index] = {
                        title: newTitle,
                        reps: newReps,
                        workTime: newWork,
                        restTime: newRest
                    };
                    updateTimeline();
                    calculateTotalTime();
                }
            });

            cancelBtn.addEventListener('click', function() {
                timelineItem.innerHTML = originalContent;
            });
        }

        function moveExercise(index, direction) {
            if (index + direction < 0 || index + direction >= exercises.length) return;
            
            // Swap exercises
            var temp = exercises[index];
            exercises[index] = exercises[index + direction];
            exercises[index + direction] = temp;
            
            // Adjust current exercise index if needed
            if (currentExerciseIndex === index) {
                currentExerciseIndex = index + direction;
            } else if (currentExerciseIndex === index + direction) {
                currentExerciseIndex = index;
            }
            
            updateTimeline();
        }

        function toggleDashboard() {
            var dashboard = document.getElementById('dashboardMode');
            dashboard.classList.add('active');
            updateDashboard();
        }

        function closeDashboard() {
            var dashboard = document.getElementById('dashboardMode');
            dashboard.classList.remove('active');
        }

        function updateDashboard() {
            // Update current exercise info
            if (exercises.length === 0) {
                document.getElementById('dashCurrentExercise').textContent = 'Ready to Start';
                document.getElementById('dashCurrentRep').textContent = 'Rep 0 of 0';
                document.getElementById('dashCurrentPhase').textContent = 'Ready';
                document.getElementById('dashTimerDisplay').textContent = '00:00';
                document.getElementById('dashTimerLabel').textContent = 'Ready';
                document.getElementById('nextExerciseSection').style.display = 'none';
                document.getElementById('dashRepProgressContainer').style.display = 'none';
                document.getElementById('dashKPIs').style.display = 'none';
                return;
            }

            var currentExercise = exercises[currentExerciseIndex];
            
            if (isRunning || isPaused) {
                document.getElementById('dashCurrentExercise').textContent = currentExercise.title;
                document.getElementById('dashCurrentRep').textContent = 'Rep ' + (currentRep + 1) + ' of ' + currentExercise.reps;
                document.getElementById('dashCurrentPhase').textContent = isWorkPhase ? 'WORK' : 'REST';
                document.getElementById('dashTimerLabel').textContent = isWorkPhase ? 'Work Time' : 'Rest Time';
                
                // Show and update dashboard rep progress
                document.getElementById('dashRepProgressContainer').style.display = 'block';
                updateDashboardRepProgress();
                
                // Show and update real-time KPIs
                document.getElementById('dashKPIs').style.display = 'grid';
                updateRealTimeKPIs();
                
                // Update next exercise preview
                var nextExerciseIndex = currentExerciseIndex;
                var nextRep = currentRep;
                var nextIsWork = isWorkPhase;
                
                // Calculate next phase
                if (nextIsWork) {
                    nextIsWork = false; // Next will be rest
                } else {
                    nextRep++;
                    if (nextRep >= currentExercise.reps) {
                        nextExerciseIndex++;
                        nextRep = 0;
                    }
                    nextIsWork = true; // Next will be work
                }
                
                var nextExerciseSection = document.getElementById('nextExerciseSection');
                if (nextExerciseIndex < exercises.length) {
                    var nextExercise = exercises[nextExerciseIndex];
                    document.getElementById('nextExerciseName').textContent = nextExercise.title;
                    document.getElementById('nextExerciseDetails').textContent = 
                        'Rep ' + (nextRep + 1) + ' of ' + nextExercise.reps + ' - ' + (nextIsWork ? 'WORK' : 'REST');
                    nextExerciseSection.style.display = 'block';
                } else {
                    nextExerciseSection.style.display = 'none';
                }
                
                // Update big circular progress (countdown style - starts full, empties as time runs out)
                var totalTime = isWorkPhase ? currentExercise.workTime : currentExercise.restTime;
                var progress = (timeRemaining / totalTime) * 100; // Countdown: full to empty
                var circumference = 2 * Math.PI * 180;
                var offset = circumference - (progress / 100 * circumference);
                document.getElementById('dashProgressCircle').style.strokeDashoffset = offset;
                
                // Update button states
                document.getElementById('dashStartBtn').style.display = 'none';
                document.getElementById('dashPauseBtn').style.display = 'inline-block';
                
                // Add pulse animation for last 5 seconds
                var dashTimerDisplay = document.getElementById('dashTimerDisplay');
                if (timeRemaining <= 5) {
                    dashTimerDisplay.classList.add('pulse-animation');
                } else {
                    dashTimerDisplay.classList.remove('pulse-animation');
                }
            } else {
                document.getElementById('dashCurrentExercise').textContent = currentExercise ? currentExercise.title : 'Ready to Start';
                document.getElementById('dashCurrentRep').textContent = 'Rep 0 of 0';
                document.getElementById('dashCurrentPhase').textContent = 'Ready';
                document.getElementById('dashTimerLabel').textContent = 'Ready';
                document.getElementById('nextExerciseSection').style.display = 'none';
                document.getElementById('dashRepProgressContainer').style.display = 'none';
                document.getElementById('dashKPIs').style.display = 'none';
                
                document.getElementById('dashStartBtn').style.display = 'inline-block';
                document.getElementById('dashPauseBtn').style.display = 'none';
            }
            
            document.getElementById('dashTimerDisplay').textContent = formatTime(timeRemaining);
            
            // Update overall progress in dashboard (both top and bottom)
            var overallProgress = totalWorkoutTime > 0 ? (elapsedTime / totalWorkoutTime) * 100 : 0;
            document.getElementById('dashOverallProgress').textContent = Math.round(overallProgress) + '%';
            document.getElementById('dashOverallProgressBar').style.width = overallProgress + '%';
            
            // Update top progress bar
            document.getElementById('dashOverallProgressTop').textContent = Math.round(overallProgress) + '%';
            document.getElementById('dashOverallProgressBarTop').style.width = overallProgress + '%';
            
            document.getElementById('dashTimeElapsed').textContent = formatTime(elapsedTime);
            document.getElementById('dashTimeRemaining').textContent = formatTime(Math.max(0, totalWorkoutTime - elapsedTime));
            
            // Update top time displays
            document.getElementById('dashTimeElapsedTop').textContent = formatTime(elapsedTime);
            document.getElementById('dashTimeRemainingTop').textContent = formatTime(Math.max(0, totalWorkoutTime - elapsedTime));
        }

        function updateDashboardRepProgress() {
            if (exercises.length === 0 || !isRunning) return;
            
            var currentExercise = exercises[currentExerciseIndex];
            var container = document.getElementById('dashRepProgressSquares');
            
            var html = '';
            for (var i = 0; i < currentExercise.reps; i++) {
                var squareClass = 'rep-square ';
                
                if (i < currentRep) {
                    // Completed reps
                    squareClass += 'completed';
                } else if (i === currentRep) {
                    // Current rep
                    squareClass += 'current';
                } else {
                    // Remaining reps
                    squareClass += 'remaining';
                }
                
                html += '<div class="' + squareClass + '" title="Rep ' + (i + 1) + '"></div>';
            }
            
            container.innerHTML = html;
        }

        function updateRealTimeKPIs() {
            if (!isRunning) return;
            
            // Calculate total reps completed across all exercises
            var totalRepsCompleted = 0;
            for (var i = 0; i < currentExerciseIndex; i++) {
                totalRepsCompleted += exercises[i].reps;
            }
            totalRepsCompleted += currentRep;
            if (!isWorkPhase && currentRep < exercises[currentExerciseIndex].reps) {
                totalRepsCompleted++; // Count current rep as completed during rest
            }
            
            // Calculate average rep time (work + rest time per rep)
            var avgRepTimeSeconds = 0;
            if (totalRepsCompleted > 0) {
                avgRepTimeSeconds = Math.floor(elapsedTime / totalRepsCompleted);
            }
            
            // Calculate workout intensity (% of time spent working vs resting)
            var totalWorkTime = 0;
            var totalRestTime = 0;
            for (var i = 0; i < exercises.length; i++) {
                var exercise = exercises[i];
                totalWorkTime += exercise.reps * exercise.workTime;
                totalRestTime += exercise.reps * exercise.restTime;
            }
            var workIntensity = totalWorkTime > 0 ? Math.round((totalWorkTime / (totalWorkTime + totalRestTime)) * 100) : 0;
            
            // Calculate calories burned (basic estimation: 5-12 calories per minute depending on intensity)
            var caloriesPerMinute = workIntensity > 70 ? 12 : (workIntensity > 50 ? 8 : 5);
            var caloriesBurned = Math.round((elapsedTime / 60) * caloriesPerMinute);
            
            // Update KPI displays
            document.getElementById('totalRepsCompleted').textContent = totalRepsCompleted;
            document.getElementById('avgRepTime').textContent = formatTime(avgRepTimeSeconds);
            document.getElementById('workoutIntensity').textContent = workIntensity + '%';
            document.getElementById('caloriesBurned').textContent = caloriesBurned;
        }

        function skipRest() {
            if (!isRunning || isWorkPhase) return;
            
            // Skip rest and go to next work phase
            nextPhase();
        }

        function saveWorkout() {
            if (exercises.length === 0) {
                showAlert('No exercises to save! Add some exercises first.');
                return;
            }

            var workoutData = {
                name: 'My Workout - ' + new Date().toLocaleDateString(),
                exercises: exercises,
                created: new Date().toISOString()
            };

            var dataStr = JSON.stringify(workoutData, null, 2);
            var dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            var link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'workout-' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            
            showAlert('Workout saved successfully!');
        }

        function loadWorkout() {
            document.getElementById('fileInput').click();
        }

        function handleFileLoad(event) {
            var file = event.target.files[0];
            if (!file) return;

            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    var workoutData = JSON.parse(e.target.result);
                    
                    if (workoutData.exercises && Array.isArray(workoutData.exercises)) {
                        exercises = workoutData.exercises;
                        updateTimeline();
                        calculateTotalTime();
                        showAlert('Workout loaded successfully!');
                    } else {
                        showAlert('Invalid workout file format.');
                    }
                } catch (error) {
                    showAlert('Error loading workout file.');
                }
            };
            reader.readAsText(file);
        }

        function loadTemplate(templateType) {
            var templateExercises = [];
            
            switch(templateType) {
                case 'hiit':
                    templateExercises = [
                        { title: 'Jumping Jacks', reps: 3, workTime: 30, restTime: 15 },
                        { title: 'High Knees', reps: 3, workTime: 30, restTime: 15 },
                        { title: 'Burpees', reps: 3, workTime: 30, restTime: 15 },
                        { title: 'Mountain Climbers', reps: 3, workTime: 30, restTime: 15 }
                    ];
                    break;
                case 'tabata':
                    templateExercises = [
                        { title: 'Squats', reps: 8, workTime: 20, restTime: 10 }
                    ];
                    break;
                case 'strength':
                    templateExercises = [
                        { title: 'Push-ups', reps: 3, workTime: 60, restTime: 90 },
                        { title: 'Squats', reps: 3, workTime: 60, restTime: 90 },
                        { title: 'Lunges', reps: 3, workTime: 60, restTime: 90 },
                        { title: 'Plank', reps: 3, workTime: 60, restTime: 90 },
                        { title: 'Deadlifts', reps: 3, workTime: 60, restTime: 90 }
                    ];
                    break;
            }
            
            if (exercises.length > 0) {
                showConfirmDialog('This will replace your current workout. Continue?', function() {
                    exercises = templateExercises;
                    updateTimeline();
                    calculateTotalTime();
                });
            } else {
                exercises = templateExercises;
                updateTimeline();
                calculateTotalTime();
            }
        }

        function updateSkipButton() {
            var skipBtn = document.getElementById('skipBtn');
            var dashSkipBtn = document.getElementById('dashSkipBtn');
            
            // Show skip button only during rest periods
            if (isRunning && !isWorkPhase) {
                skipBtn.style.display = 'inline-block';
                dashSkipBtn.style.display = 'inline-block';
            } else {
                skipBtn.style.display = 'none';
                dashSkipBtn.style.display = 'none';
            }
        }

        // Drag and Drop Variables
        var isDragModeActive = false;
        var draggedItem = null;
        var draggedIndex = -1;
        var dragGhost = null;
        var touchStartY = 0;
        var dragThreshold = 10;

        function toggleDragMode() {
            isDragModeActive = !isDragModeActive;
            var dragModeBtn = document.getElementById('dragModeBtn');
            var dragModeIndicator = document.getElementById('dragModeIndicator');
            var timeline = document.getElementById('workoutTimeline');
            
            if (isDragModeActive) {
                dragModeBtn.textContent = '‚úì Drag Active';
                dragModeBtn.classList.remove('bg-purple-500', 'hover:bg-purple-600');
                dragModeBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                dragModeIndicator.classList.remove('hidden');
                timeline.classList.add('drag-mode-active');
                enableDragAndDrop();
            } else {
                dragModeBtn.textContent = 'üéØ Drag Mode';
                dragModeBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                dragModeBtn.classList.add('bg-purple-500', 'hover:bg-purple-600');
                dragModeIndicator.classList.add('hidden');
                timeline.classList.remove('drag-mode-active');
                disableDragAndDrop();
            }
        }

        function enableDragAndDrop() {
            var timeline = document.getElementById('workoutTimeline');
            timeline.addEventListener('touchstart', handleTouchStart, { passive: false });
            timeline.addEventListener('touchmove', handleTouchMove, { passive: false });
            timeline.addEventListener('touchend', handleTouchEnd, { passive: false });
            timeline.addEventListener('mousedown', handleMouseDown);
            timeline.addEventListener('mousemove', handleMouseMove);
            timeline.addEventListener('mouseup', handleMouseEnd);
        }

        function disableDragAndDrop() {
            var timeline = document.getElementById('workoutTimeline');
            timeline.removeEventListener('touchstart', handleTouchStart);
            timeline.removeEventListener('touchmove', handleTouchMove);
            timeline.removeEventListener('touchend', handleTouchEnd);
            timeline.removeEventListener('mousedown', handleMouseDown);
            timeline.removeEventListener('mousemove', handleMouseMove);
            timeline.removeEventListener('mouseup', handleMouseEnd);
            
            cleanupDrag();
        }

        function handleTouchStart(e) {
            if (!isDragModeActive) return;
            
            var touch = e.touches[0];
            var timelineItem = touch.target.closest('.timeline-item');
            if (!timelineItem) return;
            
            touchStartY = touch.clientY;
            draggedItem = timelineItem;
            draggedIndex = parseInt(timelineItem.getAttribute('data-exercise-index'));
            
            // Prevent scrolling while dragging
            e.preventDefault();
        }

        function handleTouchMove(e) {
            if (!draggedItem) return;
            
            var touch = e.touches[0];
            var deltaY = Math.abs(touch.clientY - touchStartY);
            
            if (deltaY > dragThreshold && !dragGhost) {
                startDrag(touch.clientX, touch.clientY);
            }
            
            if (dragGhost) {
                updateDragPosition(touch.clientX, touch.clientY);
                updateDropIndicator(touch.clientX, touch.clientY);
            }
            
            e.preventDefault();
        }

        function handleTouchEnd(e) {
            if (dragGhost) {
                var touch = e.changedTouches[0];
                finishDrag(touch.clientX, touch.clientY);
            }
            cleanupDrag();
        }

        function handleMouseDown(e) {
            if (!isDragModeActive) return;
            
            var timelineItem = e.target.closest('.timeline-item');
            if (!timelineItem) return;
            
            draggedItem = timelineItem;
            draggedIndex = parseInt(timelineItem.getAttribute('data-exercise-index'));
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseEnd);
            
            e.preventDefault();
        }

        function handleMouseMove(e) {
            if (!draggedItem) return;
            
            if (!dragGhost) {
                startDrag(e.clientX, e.clientY);
            }
            
            if (dragGhost) {
                updateDragPosition(e.clientX, e.clientY);
                updateDropIndicator(e.clientX, e.clientY);
            }
        }

        function handleMouseEnd(e) {
            if (dragGhost) {
                finishDrag(e.clientX, e.clientY);
            }
            cleanupDrag();
            
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseEnd);
        }

        function startDrag(clientX, clientY) {
            if (!draggedItem) return;
            
            // Create visual feedback
            draggedItem.classList.add('dragging');
            
            // Create drag ghost
            dragGhost = draggedItem.cloneNode(true);
            dragGhost.classList.remove('dragging');
            dragGhost.classList.add('drag-ghost');
            dragGhost.style.width = draggedItem.offsetWidth + 'px';
            dragGhost.style.left = clientX - (draggedItem.offsetWidth / 2) + 'px';
            dragGhost.style.top = clientY - 40 + 'px';
            document.body.appendChild(dragGhost);
            
            // Create placeholder
            var placeholder = document.createElement('div');
            placeholder.className = 'drag-placeholder';
            placeholder.textContent = 'üìç Drop here';
            placeholder.id = 'dragPlaceholder';
            draggedItem.parentNode.insertBefore(placeholder, draggedItem.nextSibling);
        }

        function updateDragPosition(clientX, clientY) {
            if (dragGhost) {
                dragGhost.style.left = clientX - (dragGhost.offsetWidth / 2) + 'px';
                dragGhost.style.top = clientY - 40 + 'px';
            }
        }

        function updateDropIndicator(clientX, clientY) {
            var timeline = document.getElementById('workoutTimeline');
            var items = timeline.querySelectorAll('.timeline-item:not(.dragging)');
            var closestItem = null;
            var closestDistance = Infinity;
            var insertBefore = true;
            
            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                var rect = item.getBoundingClientRect();
                var centerY = rect.top + rect.height / 2;
                var distance = Math.abs(clientY - centerY);
                
                if (distance < closestDistance) {
                    closestDistance = distance;
                    closestItem = item;
                    insertBefore = clientY < centerY;
                }
            }
            
            // Remove existing indicators
            var existingIndicators = timeline.querySelectorAll('.drag-over');
            for (var i = 0; i < existingIndicators.length; i++) {
                existingIndicators[i].classList.remove('drag-over');
            }
            
            if (closestItem && closestDistance < 100) {
                closestItem.classList.add('drag-over');
            }
        }

        function finishDrag(clientX, clientY) {
            var timeline = document.getElementById('workoutTimeline');
            var items = timeline.querySelectorAll('.timeline-item:not(.dragging)');
            var targetIndex = draggedIndex;
            
            // Find drop target
            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                var rect = item.getBoundingClientRect();
                var centerY = rect.top + rect.height / 2;
                
                if (Math.abs(clientY - centerY) < 100) {
                    var itemIndex = parseInt(item.getAttribute('data-exercise-index'));
                    targetIndex = clientY < centerY ? itemIndex : itemIndex + 1;
                    break;
                }
            }
            
            // Perform the move
            if (targetIndex !== draggedIndex && targetIndex !== draggedIndex + 1) {
                moveExerciseToPosition(draggedIndex, targetIndex);
            }
        }

        function moveExerciseToPosition(fromIndex, toIndex) {
            if (fromIndex === toIndex) return;
            
            // Remove item from array
            var movedExercise = exercises.splice(fromIndex, 1)[0];
            
            // Adjust target index if we removed an item before it
            if (fromIndex < toIndex) {
                toIndex--;
            }
            
            // Insert at new position
            exercises.splice(toIndex, 0, movedExercise);
            
            // Adjust current exercise index if needed
            if (currentExerciseIndex === fromIndex) {
                currentExerciseIndex = toIndex;
            } else if (fromIndex < currentExerciseIndex && toIndex >= currentExerciseIndex) {
                currentExerciseIndex--;
            } else if (fromIndex > currentExerciseIndex && toIndex <= currentExerciseIndex) {
                currentExerciseIndex++;
            }
            
            updateTimeline();
            
            // Show feedback
            showAlert('Exercise moved successfully!');
        }

        function cleanupDrag() {
            if (draggedItem) {
                draggedItem.classList.remove('dragging');
                draggedItem = null;
            }
            
            if (dragGhost) {
                document.body.removeChild(dragGhost);
                dragGhost = null;
            }
            
            var placeholder = document.getElementById('dragPlaceholder');
            if (placeholder) {
                placeholder.parentNode.removeChild(placeholder);
            }
            
            var timeline = document.getElementById('workoutTimeline');
            var dragOverItems = timeline.querySelectorAll('.drag-over');
            for (var i = 0; i < dragOverItems.length; i++) {
                dragOverItems[i].classList.remove('drag-over');
            }
            
            draggedIndex = -1;
        }

        // Password protection variables
        var isLoggedIn = false;
        var correctPassword = "WorkNow2025";

        // Login functionality
        function handleLogin(event) {
            event.preventDefault();
            
            var passwordInput = document.getElementById('passwordInput');
            var loginError = document.getElementById('loginError');
            var enteredPassword = passwordInput.value;
            
            if (enteredPassword === correctPassword) {
                // Successful login
                isLoggedIn = true;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').classList.remove('hidden');
                
                // Clear password field
                passwordInput.value = '';
                loginError.classList.add('hidden');
            } else {
                // Failed login
                loginError.classList.remove('hidden');
                passwordInput.value = '';
                passwordInput.focus();
                
                // Shake animation for error
                passwordInput.style.animation = 'shake 0.5s';
                setTimeout(function() {
                    passwordInput.style.animation = '';
                }, 500);
            }
        }

        function logout() {
            isLoggedIn = false;
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').classList.add('hidden');
            
            // Reset any running workout
            if (isRunning || isPaused) {
                resetWorkout();
            }
            
            // Focus password field
            setTimeout(function() {
                document.getElementById('passwordInput').focus();
            }, 100);
        }

        // Add shake animation CSS
        var shakeCSS = '@keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); } }';
        var style = document.createElement('style');
        style.textContent = shakeCSS;
        document.head.appendChild(style);

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeAudio();
            
            // Bind event listeners
            document.getElementById('startBtn').addEventListener('click', startWorkout);
            document.getElementById('pauseBtn').addEventListener('click', pauseWorkout);
            document.getElementById('resetBtn').addEventListener('click', resetCurrentPhase);
            document.getElementById('skipBtn').addEventListener('click', skipRest);
            document.getElementById('addExerciseBtn').addEventListener('click', addExercise);
            document.getElementById('fullscreenBtn').addEventListener('click', toggleDashboard);
            document.getElementById('closeDashboard').addEventListener('click', closeDashboard);
            document.getElementById('saveWorkoutBtn').addEventListener('click', saveWorkout);
            document.getElementById('loadWorkoutBtn').addEventListener('click', loadWorkout);
            document.getElementById('fileInput').addEventListener('change', handleFileLoad);
            document.getElementById('dragModeBtn').addEventListener('click', toggleDragMode);
            
            // Password functionality
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Dashboard buttons
            document.getElementById('dashStartBtn').addEventListener('click', startWorkout);
            document.getElementById('dashPauseBtn').addEventListener('click', pauseWorkout);
            document.getElementById('dashSkipBtn').addEventListener('click', skipRest);
            document.getElementById('dashResetBtn').addEventListener('click', resetCurrentPhase);
            
            // Event delegation for dynamic buttons
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-exercise-btn')) {
                    var index = parseInt(e.target.getAttribute('data-index'));
                    deleteExercise(index);
                }
                if (e.target.classList.contains('edit-exercise-btn')) {
                    var index = parseInt(e.target.getAttribute('data-index'));
                    editExercise(index);
                }
                if (e.target.classList.contains('move-up-btn')) {
                    var index = parseInt(e.target.getAttribute('data-index'));
                    moveExercise(index, -1);
                }
                if (e.target.classList.contains('move-down-btn')) {
                    var index = parseInt(e.target.getAttribute('data-index'));
                    moveExercise(index, 1);
                }
                if (e.target.classList.contains('template-btn')) {
                    var template = e.target.getAttribute('data-template');
                    loadTemplate(template);
                }
            });
            
            // Initialize display
            updateDisplay();
            updateDashboard();
            updateTimeline();
            
            // Focus password field on load
            document.getElementById('passwordInput').focus();
        });
    </script>
</body>
</html>
